{% extends "base.html" %}

{% block title %}Data Cleaning - WebAnalyst{% endblock %}

{% block content %}
<style>
/* тимчасовий стиль, щоб дропдауни завжди були зверху */
.dropdown-container {
    position: relative;
    z-index: 9999;
}

.dropdown-button {
    position: relative;
    z-index: 10000;
}

.dropdown-content {
    display: none;
    position: absolute;
    background-color: #2e2e2e;
    border: 1px solid #555;
    max-height: 200px;
    overflow-y: auto;
    padding: 10px;
    border-radius: 5px;
    white-space: nowrap;
    z-index: 10001;
    top: 100%;
    left: 0;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
}

.dropdown-container:hover .dropdown-content {
    display: block;
}
</style>


<section class="data-cleaning-section">
    <div class="data-cleaning-container">

        <!-- ліва частина: завантаження файлу -->
        <div class="file-upload">
            <div class="file-drop-area" id="fileDropArea">
                <span class="file-message">Drag & drop a file here or click to upload</span>
                <input type="file" id="fileInput" name="file" accept=".xlsx,.csv" hidden>
            </div>
            <p id="fileNameDisplay" class="file-name">No file uploaded</p>
        </div>

        <!-- центральна частина: функції очищення -->
        <div class="data-cleaning-options">
            <h3>Select Cleaning Functions</h3>
            <form id="cleaningForm" enctype="multipart/form-data">
                <ul>
                    <!-- уніфікація назв колонок -->
                    <li class="cleaning-option">
                        <input type="checkbox" id="makeConsistentNames" name="cleaningFunction" value="make_consistent_column_names">
                        <label for="makeConsistentNames">Make column names consistent</label>
                    </li>

                    <!-- видалення пропущених значень -->
                    <li class="cleaning-option">
                        <input type="checkbox" id="removeMissing" name="cleaningFunction" value="remove_missing_values">
                        <label for="removeMissing">Remove missing values</label>
                        <div id="missingValueColumns" class="dropdown-container z3 hidden">
                            <div class="dropdown-button">Select columns</div>
                            <div class="dropdown-content"></div>
                        </div>
                    </li>

                    <!-- виявлення дублікатів -->
                    <li class="cleaning-option">
                        <input type="checkbox" id="detectDuplicates" name="cleaningFunction" value="detect_duplicates">
                        <label for="detectDuplicates">Detect duplicates</label>
                        <div id="selectedColumns" class="dropdown-container z2 hidden">
                            <div class="dropdown-button">Select columns</div>
                            <div class="dropdown-content"></div>
                        </div>
                    </li>

                    <!-- виправлення дат -->
                    <li class="cleaning-option">
                        <input type="checkbox" id="fixDates" name="cleaningFunction" value="fix_dates">
                        <label for="fixDates">Fix date formats</label>
                        <div id="dateColumn" class="dropdown-container z1 hidden">
                            <div class="dropdown-button">Select column</div>
                            <div class="dropdown-content"></div>
                        </div>
                    </li>

                    <!-- невідповідні значення -->
                    <li class="cleaning-option">
                        <input type="checkbox" id="detectInappropriateValues" name="cleaningFunction" value="detect_inappropriate_values">
                        <label for="detectInappropriateValues">Detect inappropriate values</label>
                    </li>

                    <!-- викиди -->
                    <li class="cleaning-option">
                        <input type="checkbox" id="detectOutliers" name="cleaningFunction" value="detect_outliers">
                        <label for="detectOutliers">Remove outliers</label>
                    </li>
                </ul>
            </form>
        </div>

        <!-- права частина: кнопки та прогрес -->
        <div class="actions">
            <button id="startProcess" class="action-button">Start Cleaning</button>
            <button id="downloadFile" class="action-button disabled" disabled>Download Cleaned File</button>
            <div class="progress-bar-container">
                <div class="progress-bar" id="progressBar">
                    <div class="progress-bar-fill" id="progressFill"></div>
                </div>
                <span id="progressText">0%</span>
            </div>
        </div>
    </div>

    <!-- контейнер для таблиць -->
    <div id="tableContainer" class="table-container"></div>
</section>

<link rel="stylesheet" href="{{ url_for('static', filename='styles/style-data-cleaning.css') }}">
<script src="{{ url_for('static', filename='scripts/data_cleaning.js') }}"></script>
{% endblock %}
